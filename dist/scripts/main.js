!function(e,i,t){"use strict";function r(e,i){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",e,!0),t.onreadystatechange=function(){4==t.readyState&&"200"==t.status&&i(t.responseText)},t.send(null)}function p(e,i){var t=e.properties.field_image_id,r="",p=e.properties.rotation.trim()||0,a=e.properties.name||"",n=o+e.properties.nid,l="";l=0!==p?"full/,"+s+"/"+p+"/native.jpg":"full/"+s+",/"+p+"/native.jpg",t&&(r=t.replace(new RegExp("(.*/)[^/]+$"),"$1")+l);var d='<div style="width:'+s+'px;""><a class="popup" href='+n+'><h3 class="popup-text">'+a+"</h3><img src="+r+"></a></div>";i.bindPopup(d,{minWidth:s})}function a(){r(l,function(e){var i=JSON.parse(e),r=t.geoJson(i,{style:function(e){return e.properties&&e.properties.style},onEachFeature:p}),a=t.markerClusterGroup({spiderfyDistanceMultiplier:3,showCoverageOnHover:!1});a.addLayer(r),d.addLayer(a)})}t.Icon.Default.imagePath="images/";var o="http://libphp-prod.princeton.edu/versailles/item/",n="http://libimages.princeton.edu/loris2/exhibits%2FVersailles%2Fversailles_13%2FImage00120_vert.jp2/info.json",s=250,l="http://github-raw-cors-proxy.herokuapp.com/eliotjordan/versailles-demo/gh-pages/app/scripts/map.json",d=t.map("map",{center:[0,0],crs:t.CRS.Simple,zoom:0}),u=t.tileLayer.iiif(n,{}).addTo(d);u.on("load",a)}(window,document,L);