!function(e,i,t){"use strict";function r(e,i){var t=new XMLHttpRequest;t.overrideMimeType("application/json"),t.open("GET",e,!0),t.onreadystatechange=function(){4==t.readyState&&"200"==t.status&&i(t.responseText)},t.send(null)}function a(e,i){var t=e.properties.field_image_id,r="",a=e.properties.rotation||0,o=e.properties.name||"",n=p+e.properties.nid,l="";l=0!==a?"full/,"+s+"/"+a+"/native.jpg":"full/"+s+",/"+a+"/native.jpg",t&&(r=t.replace(new RegExp("(.*/)[^/]+$"),"$1")+l);var d='<div style="width:'+s+'px;""><h3 class="popup-title">'+o+"</h3><a href="+n+"><img src="+r+"></a></div>";i.bindPopup(d,{minWidth:s})}function o(){r(l,function(e){var i=JSON.parse(e),r=t.geoJson(i,{style:function(e){return e.properties&&e.properties.style},onEachFeature:a}),o=t.markerClusterGroup({spiderfyDistanceMultiplier:3,showCoverageOnHover:!1});o.addLayer(r),d.addLayer(o)})}t.Icon.Default.imagePath="images/";var p="http://libphp-dev.princeton.edu/versailles/item/",n="http://libimages.princeton.edu/loris2/exhibits%2FVersailles%2Fversailles_13%2FImage00120_vert.jp2/info.json",s=250,l="http://github-raw-cors-proxy.herokuapp.com/eliotjordan/versailles-demo/gh-pages/app/scripts/map.json",d=t.map("map",{center:[0,0],crs:t.CRS.Simple,zoom:0}),u=t.tileLayer.iiif(n,{}).addTo(d);u.on("load",o)}(window,document,L);